// Test 05: Structs and field access

struct Point {
    int16 x;
    int16 y;
};

struct Rect {
    Point topLeft;
    Point bottomRight;
};

struct Buffer {
    int16 len;
    uint8 data[64];
};

var Point g_origin;
var Rect g_bounds;

func void TestStructs() {
    var Point p;
    var Rect r;
    var @Point pp;

    // Direct field access
    p.x = 10;
    p.y = 20;

    // Nested struct
    r.topLeft.x = 0;
    r.topLeft.y = 0;
    r.bottomRight.x = 100;
    r.bottomRight.y = 100;

    // Pointer to struct
    pp = &p;
    pp->x = 30;
    pp->y = 40;

    return;
}

func int16 Distance(@Point a, @Point b) {
    var int16 dx;
    var int16 dy;

    dx = b->x - a->x;
    dy = b->y - a->y;

    // Would need sqrt, just return sum of squares
    return dx * dx + dy * dy;
}

func void InitBuffer(@Buffer buf) {
    var int16 i;

    buf->len = 0;
    for (i = 0; i < 64; i = i + 1) {
        buf->data[i] = 0;
    }

    return;
}

func int16 GetSizeof() {
    var int16 s1;
    var int16 s2;
    var int16 s3;

    s1 = sizeof(Point);
    s2 = sizeof(Rect);
    s3 = sizeof(int16);

    return s1 + s2 + s3;
}
