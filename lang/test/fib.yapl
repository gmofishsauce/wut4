// fib.yapl - Print Fibonacci numbers up to the largest that fits in uint16
// Compile together with bootstrap.yapl and itoa.yapl
#pragma bootstrap

#include "../../lib/nio.inc"

// Largest Fibonacci number that fits in uint16 (65535)
const uint16 MAX_FIB = 46368;

func void Utoa(uint16 n, @byte bp) {
     //fixme
}

func void Main() {
    var byte buf[6];
    var uint16 n1;
    var uint16 n2;
    var uint16 next;

    n1 = 0;
    n2 = 1;

    // Print first Fibonacci number (1)
    Utoa(n2, &buf[0]);
    Putstr(&buf[0]);
    Putc(byte('\n'));

    // Generate and print remaining Fibonacci numbers
    // Use subtraction to avoid uint16 overflow in the addition
    while (n1 <= MAX_FIB - n2) {
        next = n1 + n2;
        Utoa(next, &buf[0]);
        Putstr(&buf[0]);
        Putc(byte('\n'));
        n1 = n2;
        n2 = next;
    }
}

