// hello, world.
#asm(".bootstrap");

const byte hello[] = "hello, world.\n";

func void main() {
    Putstr(&hello);
}

// return true if the byteis sent or false if not (i.e. overflow occurs)
func byte Putc(byte b) {

    #asm("ldi r2 96");
    #asm("ssp r1 r2");
}

// return true if the last byte we attempted to send was not sent
// because the FIFO overflowed.
func byte isOverflow() {
    #asm("ldi r2 98"); // address of transmit status register
    #asm("lsp r1 r2"); // status to r1
    #asm("ldi r2 1");  // mask overflow bit 0
    #asm("and r1, r1, r2"); // return with overflow bit in r1
}

func void Putstr(@byte bp) {

    while (@bp != 0) {
	Putc(@bp);
	if (isOverflow()) {continue;}
	bp = bp + 1;
    }
}
