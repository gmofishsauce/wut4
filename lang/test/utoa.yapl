// itoa.yapl - unsigned 16-bit integer to ASCII conversion

// Reverse a string in place
// str: pointer to first byte of string
// len: number of characters to reverse (not including null terminator)
func void reverse(@byte str, uint16 len) {
    var uint16 start;
    var uint16 end;
    var byte temp;

    start = 0;
    if (len == 0) {
        return;
    }
    end = len - 1;

    while (start < end) {
        temp = @(str + start);
        @(str + start) = @(str + end);
        @(str + end) = temp;
        start = start + 1;
        end = end - 1;
    }
}

// Convert unsigned 16-bit integer to ASCII string
// n: the number to convert
// buf: pointer to buffer (must be at least 6 bytes for max uint16 = 65535 + null)
// Returns: pointer to buf
func @byte Utoa(uint16 n, @byte buf) {
    var uint16 i;
    var uint16 digit;

    i = 0;

    // Handle zero specially
    if (n == 0) {
        @buf = '0';
        @(buf + 1) = 0;
        return buf;
    }

    // Extract digits in reverse order
    while (n != 0) {
        digit = n % 10;
        @(buf + i) = byte(digit + '0');
        i = i + 1;
        n = n / 10;
    }

    // Null terminate
    @(buf + i) = 0;

    // Reverse to get correct order
    reverse(buf, i);

    return buf;
}
